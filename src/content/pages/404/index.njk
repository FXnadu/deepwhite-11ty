<section class="page-404" aria-labelledby="page-404-title">
    <div class="page-404__terminal">
        <div class="terminal-window" data-404-terminal>
            <div class="terminal-header">
                <div class="terminal-header__dots" aria-hidden="true">
                    <span class="dot dot-red"></span>
                    <span class="dot dot-yellow"></span>
                    <span class="dot dot-green"></span>
                </div>
                <p class="terminal-title" id="page-404-title">guest@deepwhite-11ty:~ (zsh)</p>
            </div>

            <div class="terminal-body" role="status" aria-live="polite" onclick="document.getElementById('page-404-input').focus()">
                <div class="prompt">
                    <span class="user">➜</span>
                    <span class="path">~</span>
                    <span class="cmd">system_check --status</span>
                </div>
                <div class="output">
                    <span>&gt; Kernel loaded... OK</span><br>
                    <span>&gt; Loading assets... OK</span><br>
                    <span>&gt; Verifying path integrity... <span class="error-text">FAILED</span></span>
                </div>

                <div class="prompt">
                    <span class="user">➜</span>
                    <span class="path">~</span>
                    <span class="cmd">access <span data-display-url style="color: #facc15;">/unknown/path</span></span>
                </div>

                <div class="typewriter error-text" data-typewriter aria-live="assertive"></div>

                <div class="page-404__suggestions hidden" data-suggestions>
                    <span class="comment">// 别慌，检测到以下可用入口，建议尝试跳转：</span>
                    <ul class="command-list">
                        <li>
                            <a href="{{ '/' | url }}">
                                <span class="arrow" aria-hidden="true">➜</span>
                                <span class="link-cmd">cd /home</span>
                                <span class="link-desc">// 返回首页</span>
                            </a>
                        </li>
                        <li>
                            <a href="{{ '/archive/' | url }}">
                                <span class="arrow" aria-hidden="true">➜</span>
                                <span class="link-cmd">ls -a /archive</span>
                                <span class="link-desc">// 查看归档</span>
                            </a>
                        </li>
                        <li>
                            <a href="mailto:deepwhite86@outlook.com">
                                <span class="arrow" aria-hidden="true">➜</span>
                                <span class="link-cmd">mail author</span>
                                <span class="link-desc">// 联系作者</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="prompt hidden" data-prompt-cursor>
                    <span class="user">➜</span>
                    <span class="path">~</span>
                    <span class="cursor" aria-hidden="true"></span>
                    <input type="text" id="page-404-input" class="screen-reader-only" aria-hidden="true">
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const displayUrlEl = document.querySelector("[data-display-url]");
    const typewriterEl = document.querySelector("[data-typewriter]");
    const suggestionsEl = document.querySelector("[data-suggestions]");
    const promptCursorEl = document.querySelector("[data-prompt-cursor]");
    const hiddenInput = document.getElementById("page-404-input");
    if (!displayUrlEl || !typewriterEl) return;

    const path = window.location.pathname || "/";
    const cleanPath = path.length > 1 ? path.replace(/\/$/, "") : "/index";
    displayUrlEl.textContent = cleanPath;

    const commandArg = cleanPath === "/index" ? "./index" : `.${cleanPath}`;
    const message = `cat: ${commandArg}: No such file or directory`;
    let index = 0;

    function revealExtras() {
        suggestionsEl?.classList.remove("hidden");
        suggestionsEl?.classList.add("visible");
        promptCursorEl?.classList.remove("hidden");
        promptCursorEl?.classList.add("visible");
        hiddenInput?.focus();
    }

    function typeWriter() {
        if (index < message.length) {
            typewriterEl.textContent += message.charAt(index);
            index += 1;
            window.setTimeout(typeWriter, 40);
        } else {
            window.setTimeout(revealExtras, 400);
        }
    }

    window.setTimeout(typeWriter, 800);
});
</script>
